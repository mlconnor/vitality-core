# Cursor for Food - Complete System Design Specification

## Executive Summary

**Cursor for Food** is an AI-native commercial kitchen management platform that mirrors the architecture and UX patterns of Cursor IDE, adapted for food service operations. Just as Cursor transformed software development by placing AI at the center of the coding experience, this system transforms commercial kitchen management from traditional CRUD operations into an intelligent, agent-driven command center.

### Vision Statement

> "Cursor democratized AI-assisted coding by making the AI a first-class participant in the development process. Cursor for Food does the same for commercial kitchensâ€”the AI isn't an add-on feature, it's the core interaction model."

### Key Differentiators

| Cursor IDE | Cursor for Food |
|------------|-----------------|
| File tree navigation | Entity tree navigation |
| Code search (Cmd+K) | Omni-search across entities |
| AI chat panel | Agent panel with specialized tools |
| Code editor | Rich entity views with GUI editing |
| .cursorrules files | Hierarchical LLM notes on entities |
| Language servers | Domain-specific algorithms as tools |

### Target Users

- **Executive Chefs**: Menu planning, recipe development, cost optimization
- **Site Managers**: Operations oversight, compliance, staff coordination
- **Dietitians**: Therapeutic diet management, nutritional analysis
- **Kitchen Staff**: Production schedules, prep checklists, HACCP logging
- **Procurement**: Vendor management, purchase orders, inventory control

---

## Part 1: Core Architecture - The Cursor Paradigm

### 1.1 Application Layout

The application follows Cursor's proven three-panel layout with a command bar:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [âŒ˜K] Search entities, run commands, ask questions...              [ğŸ‘¤] [âš™ï¸]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                â”‚                                            â”‚                  â”‚
â”‚   ENTITY       â”‚           CENTER CANVAS                    â”‚    AGENT         â”‚
â”‚   TREE         â”‚                                            â”‚    PANEL         â”‚
â”‚                â”‚   (Rich views, forms, calendars,           â”‚                  â”‚
â”‚   (Domain      â”‚    tables, dashboards)                     â”‚   (Chat, voice,  â”‚
â”‚   hierarchy)   â”‚                                            â”‚    tools, logs)  â”‚
â”‚                â”‚                                            â”‚                  â”‚
â”‚   [Resizable]  â”‚           [Tabbed interface]               â”‚   [Collapsible]  â”‚
â”‚                â”‚                                            â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PRESENTATION LAYER                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Entity Tree  â”‚  â”‚     Center Canvas        â”‚  â”‚     Agent Panel        â”‚     â”‚
â”‚  â”‚              â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚  â”‚ â€¢ Sites      â”‚  â”‚  â”‚ Entity Views      â”‚  â”‚  â”‚  â”‚ Chat Interface   â”‚  â”‚     â”‚
â”‚  â”‚ â€¢ Diners     â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚     â”‚
â”‚  â”‚ â€¢ Menus      â”‚  â”‚  â”‚ Calendars         â”‚  â”‚  â”‚  â”‚ Voice Input      â”‚  â”‚     â”‚
â”‚  â”‚ â€¢ Recipes    â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚     â”‚
â”‚  â”‚ â€¢ Inventory  â”‚  â”‚  â”‚ Tables/Grids      â”‚  â”‚  â”‚  â”‚ Tool Execution   â”‚  â”‚     â”‚
â”‚  â”‚ â€¢ Production â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚     â”‚
â”‚  â”‚              â”‚  â”‚  â”‚ Dashboards        â”‚  â”‚  â”‚  â”‚ Context Display  â”‚  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              OMNI-SEARCH (âŒ˜K)                                   â”‚
â”‚         Natural language â€¢ Entity filtering â€¢ Commands â€¢ Recent items           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              AGENT ORCHESTRATION LAYER                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Context        â”‚  â”‚ Tool           â”‚  â”‚ LLM            â”‚  â”‚ Memory       â”‚  â”‚
â”‚  â”‚ Aggregator     â”‚  â”‚ Router         â”‚  â”‚ Interface      â”‚  â”‚ Manager      â”‚  â”‚
â”‚  â”‚ (llm_notes)    â”‚  â”‚ (MCP-style)    â”‚  â”‚ (Claude/GPT)   â”‚  â”‚ (History)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              TOOL LAYER                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   CORE DATA TOOLS    â”‚  â”‚   ALGORITHM TOOLS    â”‚  â”‚   EXTERNAL TOOLS     â”‚  â”‚
â”‚  â”‚   â€¢ db_query         â”‚  â”‚   â€¢ protein_spread   â”‚  â”‚   â€¢ weather_get      â”‚  â”‚
â”‚  â”‚   â€¢ db_mutate        â”‚  â”‚   â€¢ scale_recipe     â”‚  â”‚   â€¢ seasonal_produce â”‚  â”‚
â”‚  â”‚   â€¢ schema_inspect   â”‚  â”‚   â€¢ cost_optimize    â”‚  â”‚   â€¢ sysco_search     â”‚  â”‚
â”‚  â”‚   â€¢ entity_search    â”‚  â”‚   â€¢ forecast_demand  â”‚  â”‚   â€¢ sysco_order      â”‚  â”‚
â”‚  â”‚                      â”‚  â”‚   â€¢ validate_diet    â”‚  â”‚   â€¢ browser_navigate â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              SERVICE LAYER (tRPC API)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Menu   â”‚ â”‚Productionâ”‚ â”‚ Inventory â”‚ â”‚ Diners   â”‚ â”‚ Recipes â”‚ â”‚Procurementâ”‚ â”‚
â”‚  â”‚ Service â”‚ â”‚ Service  â”‚ â”‚  Service  â”‚ â”‚ Service  â”‚ â”‚ Service â”‚ â”‚ Service  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              DATA LAYER (SQLite + Drizzle ORM)                  â”‚
â”‚                                                                                 â”‚
â”‚    tenants â”‚ sites â”‚ stations â”‚ employees â”‚ diners â”‚ recipes â”‚ ingredients     â”‚
â”‚    meal_periods â”‚ diet_types â”‚ cycle_menus â”‚ menu_items â”‚ inventory â”‚ etc.     â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 Data Flow Architecture

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   User Action   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                        â”‚                        â”‚
                    â–¼                        â–¼                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Direct CRUD  â”‚      â”‚  Omni-Search    â”‚      â”‚  Agent Chat     â”‚
            â”‚  (Entity View)â”‚      â”‚  (âŒ˜K)           â”‚      â”‚  (Text/Voice)   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                       â”‚                        â”‚
                    â”‚                       â”‚                        â–¼
                    â”‚                       â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                       â”‚               â”‚ Context         â”‚
                    â”‚                       â”‚               â”‚ Aggregation     â”‚
                    â”‚                       â”‚               â”‚ (llm_notes)     â”‚
                    â”‚                       â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                       â”‚                        â”‚
                    â”‚                       â”‚                        â–¼
                    â”‚                       â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                       â”‚               â”‚ LLM Processing  â”‚
                    â”‚                       â”‚               â”‚ + Tool Routing  â”‚
                    â”‚                       â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                       â”‚                        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚  tRPC Services  â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚  Drizzle ORM    â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚  SQLite DB      â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 2: User Interface Specification

### 2.1 Entity Tree Panel (Left)

The entity tree replaces Cursor's file explorer with a domain-specific hierarchy:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ENTITY EXPLORER                    [â‰¡] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ğŸ¢ Sunrise Senior Living               â”‚
â”‚  â”‚                                      â”‚
â”‚  â”œâ”€ğŸ“ Sites                             â”‚
â”‚  â”‚  â”œâ”€ğŸ  Main Campus Kitchen            â”‚
â”‚  â”‚  â”‚  â”œâ”€ğŸ”§ Stations                    â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Grill Station              â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Steam Table                â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Trayline                   â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ Salad Bar                  â”‚
â”‚  â”‚  â”‚  â”œâ”€ğŸ‘¥ Employees (12)          [+] â”‚
â”‚  â”‚  â”‚  â””â”€âš ï¸ Inventory Alerts (3)        â”‚
â”‚  â”‚  â”‚                                   â”‚
â”‚  â”‚  â””â”€ğŸ  Satellite Dining               â”‚
â”‚  â”‚     â””â”€ ...                           â”‚
â”‚  â”‚                                      â”‚
â”‚  â”œâ”€ğŸ‘¤ Diners (127 active)               â”‚
â”‚  â”‚  â”œâ”€ğŸ“‹ By Room/Location           [â–¾] â”‚
â”‚  â”‚  â”‚  â”œâ”€ Wing A (42)                   â”‚
â”‚  â”‚  â”‚  â”œâ”€ Wing B (38)                   â”‚
â”‚  â”‚  â”‚  â””â”€ Wing C (47)                   â”‚
â”‚  â”‚  â””â”€ğŸ¥— By Diet Type               [â–¸] â”‚
â”‚  â”‚                                      â”‚
â”‚  â”œâ”€ğŸ“… Menu Planning                     â”‚
â”‚  â”‚  â”œâ”€âœ… Active: Spring 2026 Cycle      â”‚
â”‚  â”‚  â”‚  â”œâ”€ Week 1                        â”‚
â”‚  â”‚  â”‚  â”œâ”€ Week 2                        â”‚
â”‚  â”‚  â”‚  â”œâ”€ Week 3                        â”‚
â”‚  â”‚  â”‚  â””â”€ Week 4                        â”‚
â”‚  â”‚  â””â”€ğŸ“ Draft Cycles                   â”‚
â”‚  â”‚                                      â”‚
â”‚  â”œâ”€ğŸ“– Recipes (342)                     â”‚
â”‚  â”‚  â”œâ”€ By Category                  [â–¸] â”‚
â”‚  â”‚  â””â”€ By Cuisine                   [â–¸] â”‚
â”‚  â”‚                                      â”‚
â”‚  â”œâ”€ğŸ¥• Ingredients (1,247)               â”‚
â”‚  â”‚                                      â”‚
â”‚  â”œâ”€ğŸš› Vendors (8)                       â”‚
â”‚  â”‚                                      â”‚
â”‚  â””â”€ğŸ­ Production                        â”‚
â”‚     â”œâ”€ Today's Schedule                 â”‚
â”‚     â”œâ”€ Forecasts                        â”‚
â”‚     â””â”€ Leftover Reports                 â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Entity Tree Features

| Feature | Description |
|---------|-------------|
| **Inline Tables** | Expand a node (e.g., "Diners") to show filterable data grid |
| **Badges** | Show counts, alerts (âš ï¸), status indicators |
| **Drag & Drop** | Move items between containers (e.g., assign employee to station) |
| **Context Menus** | Right-click for entity-specific actions |
| **Search Filter** | Local filter within tree (separate from âŒ˜K) |
| **Favorites** | Pin frequently accessed entities to top |
| **Recent** | Quick access to recently viewed entities |

#### Tree Node Types

```typescript
interface EntityTreeNode {
  id: string;
  entityType: EntityType;
  label: string;
  icon: string;
  badge?: {
    count?: number;
    type: 'info' | 'warning' | 'error';
  };
  children?: EntityTreeNode[];
  expandable: boolean;
  selectable: boolean;
  droppable: boolean;
  contextActions: ContextAction[];
}

type EntityType = 
  | 'tenant' | 'site' | 'station' | 'employee'
  | 'diner' | 'diner_group'
  | 'cycle_menu' | 'menu_week' | 'menu_item'
  | 'recipe' | 'recipe_category'
  | 'ingredient' | 'ingredient_category'
  | 'vendor' | 'purchase_order'
  | 'production_schedule' | 'forecast';
```

### 2.2 Omni-Search (âŒ˜K)

The command palette provides universal access to entities, commands, and AI assistance:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ˜K  Search entities, run commands, or ask a question...                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  RECENT                                                                         â”‚
â”‚  â”œâ”€ ğŸ• Maria Rodriguez (Diner, Room 204)                                        â”‚
â”‚  â”œâ”€ ğŸ• Spring 2026 Cycle Menu                                                   â”‚
â”‚  â””â”€ ğŸ• Beef Bourguignon (Recipe)                                                â”‚
â”‚                                                                                 â”‚
â”‚  QUICK ACTIONS                                                                  â”‚
â”‚  â”œâ”€ â• Create new recipe                                                        â”‚
â”‚  â”œâ”€ ğŸ“‹ Generate today's production sheet                                        â”‚
â”‚  â”œâ”€ ğŸ›’ Create purchase order                                                    â”‚
â”‚  â””â”€ ğŸ‘¤ Add new diner                                                            â”‚
â”‚                                                                                 â”‚
â”‚  ASK AGENT                                                                      â”‚
â”‚  â””â”€ ğŸ’¬ "What can I make with excess zucchini?"                                  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Search Syntax

| Syntax | Example | Description |
|--------|---------|-------------|
| Plain text | `chicken breast` | Search all entities |
| `@type` | `@recipe chicken` | Filter by entity type |
| `#tag` | `@recipe #lowsodium` | Filter by tag/diet |
| `>command` | `>create recipe` | Execute command |
| `?question` | `?cost of today's lunch` | Ask agent |
| `$cost:` | `@recipe $cost:<2` | Filter by attribute |

#### Search Results Structure

```typescript
interface SearchResult {
  id: string;
  entityType: EntityType;
  title: string;
  subtitle: string;
  icon: string;
  score: number;
  highlights: TextHighlight[];
  actions: QuickAction[];
}

interface QuickAction {
  label: string;
  icon: string;
  shortcut?: string;
  handler: () => void;
}
```

### 2.3 Agent Panel (Right)

The AI assistant panel provides conversational interaction with context awareness:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– KITCHEN ASSISTANT              [âš™ï¸] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ğŸ“ Context: Main Campus Kitchen        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Active rules from:                â”‚  â”‚
â”‚  â”‚ â€¢ Tenant: Sunrise Senior Living   â”‚  â”‚
â”‚  â”‚ â€¢ Site: Main Campus Kitchen       â”‚  â”‚
â”‚  â”‚ â€¢ Cycle: Spring 2026              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ‘¤ You                            â”‚  â”‚
â”‚  â”‚ What can I make with the 15 lbs   â”‚  â”‚
â”‚  â”‚ of excess roasted chicken from    â”‚  â”‚
â”‚  â”‚ lunch?                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ¤– Assistant                      â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚ Based on your inventory and       â”‚  â”‚
â”‚  â”‚ tomorrow's menu, here are the     â”‚  â”‚
â”‚  â”‚ best options:                     â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚ 1. **Chicken Salad** (Lunch)      â”‚  â”‚
â”‚  â”‚    Uses: 8 lbs | Saves: $47       â”‚  â”‚
â”‚  â”‚    âœ“ Already on tomorrow's menu   â”‚  â”‚
â”‚  â”‚    [Add to Production] [Recipe]   â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚ 2. **Chicken Pot Pie** (Dinner)   â”‚  â”‚
â”‚  â”‚    Uses: 10 lbs | Cost: $1.89/srv â”‚  â”‚
â”‚  â”‚    âš ï¸ Requires pie crust (in stock)â”‚  â”‚
â”‚  â”‚    [Schedule] [View Recipe]       â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚ 3. **Chicken Soup** (Lunch)       â”‚  â”‚
â”‚  â”‚    Uses: 5 lbs | Cost: $0.95/srv  â”‚  â”‚
â”‚  â”‚    âœ“ Good for cooler weather      â”‚  â”‚
â”‚  â”‚    [Schedule] [View Recipe]       â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚
â”‚  â”‚ ğŸ”§ Tools used:                    â”‚  â”‚
â”‚  â”‚ â€¢ inventory_check                 â”‚  â”‚
â”‚  â”‚ â€¢ recipe_search                   â”‚  â”‚
â”‚  â”‚ â€¢ cost_calculate                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Type a message or ğŸ¤ speak...     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  [ğŸ“ Attach] [ğŸ¤ Voice] [Send â†’]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Agent Panel Features

| Feature | Description |
|---------|-------------|
| **Context Display** | Shows active llm_notes from entity hierarchy |
| **Tool Transparency** | Displays which tools were invoked |
| **Action Buttons** | One-click actions from agent suggestions |
| **Voice Input** | Speech-to-text for hands-free operation |
| **File Attachments** | Attach images (e.g., delivery invoice photo) |
| **Conversation History** | Scrollable history with search |
| **Agent Personalities** | Switch between Chef, Dietitian, Manager modes |

### 2.4 Center Canvas Views

The center pane displays rich, entity-specific views:

#### 2.4.1 Recipe View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“– Beef Bourguignon                                    [Edit] [Clone] [Print]  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  [Details] [Ingredients â—] [Method] [Nutrition] [Scaling] [History]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  RECIPE INFORMATION                 â”‚  QUICK STATS                         â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚  Category: EntrÃ©e                   â”‚  Cost/Portion:    $2.34              â”‚ â”‚
â”‚  â”‚  Cuisine:  French                   â”‚  Yield:           48 portions        â”‚ â”‚
â”‚  â”‚  Method:   Braise                   â”‚  Portion Size:    8 oz               â”‚ â”‚
â”‚  â”‚  Status:   âœ“ Standardized           â”‚  Prep Time:       45 min             â”‚ â”‚
â”‚  â”‚                                     â”‚  Cook Time:       2.5 hrs            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  INGREDIENTS                                                        [+ Add]    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  â”‚ QTY     â”‚ UNIT  â”‚ INGREDIENT            â”‚ PREP        â”‚ COST    â”‚ AP/EP â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 10      â”‚ lb    â”‚ Beef Chuck            â”‚ 1" cubes    â”‚ $48.90  â”‚ EP    â”‚   â”‚
â”‚  â”‚ 1       â”‚ btl   â”‚ Red Wine, Burgundy    â”‚             â”‚ $12.00  â”‚ AP    â”‚   â”‚
â”‚  â”‚ 2       â”‚ lb    â”‚ Pearl Onions          â”‚ peeled      â”‚ $5.80   â”‚ EP    â”‚   â”‚
â”‚  â”‚ 1       â”‚ lb    â”‚ Mushrooms, cremini    â”‚ quartered   â”‚ $4.20   â”‚ EP    â”‚   â”‚
â”‚  â”‚ 8       â”‚ oz    â”‚ Bacon                 â”‚ lardons     â”‚ $3.50   â”‚ AP    â”‚   â”‚
â”‚  â”‚ 4       â”‚ Tbsp  â”‚ Flour                 â”‚             â”‚ $0.12   â”‚ AP    â”‚   â”‚
â”‚  â”‚ 2       â”‚ cup   â”‚ Beef Stock            â”‚             â”‚ $1.60   â”‚ AP    â”‚   â”‚
â”‚  â”‚ ...     â”‚       â”‚                       â”‚             â”‚         â”‚       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ SUBTOTAL                                              â”‚ $112.40         â”‚   â”‚
â”‚  â”‚ Waste Factor (5%)                                     â”‚ $5.62           â”‚   â”‚
â”‚  â”‚ TOTAL RECIPE COST                                     â”‚ $118.02         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ”„ SCALE RECIPE                    â”‚  ğŸ·ï¸ DIET COMPATIBILITY               â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚  Target yield: [65    ] portions    â”‚  âœ“ Regular        âœ“ Low Sodium       â”‚ â”‚
â”‚  â”‚                                     â”‚  âœ— Diabetic       âœ“ Gluten-Free      â”‚ â”‚
â”‚  â”‚  Upcoming production:               â”‚  âœ“ Renal          âœ— Vegetarian       â”‚ â”‚
â”‚  â”‚  â€¢ Mon Dinner: 65 portions          â”‚                                      â”‚ â”‚
â”‚  â”‚  â€¢ Thu Dinner: 48 portions          â”‚  [Auto-generate Diet Extensions]     â”‚ â”‚
â”‚  â”‚                                     â”‚                                      â”‚ â”‚
â”‚  â”‚  [Calculate Scaled Ingredients]     â”‚                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ’¡ AGENT SUGGESTIONS                                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  â€¢ Beef chuck price increased 12% this month. [See alternatives]                â”‚
â”‚  â€¢ This recipe pairs well with: Rice Pilaf ($0.34), Crusty Bread ($0.22)        â”‚
â”‚  â€¢ Last served 8 days ago with 94% consumption rate                             â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.4.2 Menu Calendar View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ½ï¸ MENU STUDIO                          Spring 2026 Cycle â”‚ Week 2 of 4       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  [Week 1] [Week 2 â—] [Week 3] [Week 4]         Diet: [All â–¼]  Site: [Main â–¼]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚        â”‚ MONDAY      â”‚ TUESDAY     â”‚ WEDNESDAY   â”‚ THURSDAY    â”‚ FRIDAY       â”‚
â”‚  â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚        â”‚             â”‚             â”‚             â”‚             â”‚              â”‚
â”‚  LUNCH â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  EntrÃ©eâ”‚ â”‚ Grilled â”‚ â”‚ â”‚ Beef    â”‚ â”‚ â”‚ Chicken â”‚ â”‚ â”‚ Pasta   â”‚ â”‚ â”‚ Fish &  â”‚  â”‚
â”‚        â”‚ â”‚ Chicken â”‚ â”‚ â”‚ Tacos   â”‚ â”‚ â”‚ Stir Fryâ”‚ â”‚ â”‚Primaveraâ”‚ â”‚ â”‚ Chips   â”‚  â”‚
â”‚        â”‚ â”‚ $2.14 âœ“ â”‚ â”‚ â”‚ $2.45 âœ“ â”‚ â”‚ â”‚ $1.89 âœ“ â”‚ â”‚ â”‚ $1.67 âœ“ â”‚ â”‚ â”‚âš ï¸$3.12 â”‚  â”‚
â”‚        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚             â”‚             â”‚             â”‚             â”‚              â”‚
â”‚  Starchâ”‚ Rice Pilaf  â”‚ Refried     â”‚ Fried Rice  â”‚ (included)  â”‚ French Fries â”‚
â”‚        â”‚             â”‚ Beans       â”‚             â”‚             â”‚              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚        â”‚             â”‚             â”‚             â”‚             â”‚              â”‚
â”‚ DINNER â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  EntrÃ©eâ”‚ â”‚ Meatloafâ”‚ â”‚ â”‚ Roast   â”‚ â”‚ â”‚ Pork    â”‚ â”‚ â”‚ Beef    â”‚ â”‚ â”‚ Baked   â”‚  â”‚
â”‚        â”‚ â”‚         â”‚ â”‚ â”‚ Chicken â”‚ â”‚ â”‚ Chop    â”‚ â”‚ â”‚ Stew    â”‚ â”‚ â”‚ Salmon  â”‚  â”‚
â”‚        â”‚ â”‚ $1.98 âœ“ â”‚ â”‚ â”‚ $2.21 âœ“ â”‚ â”‚ â”‚ $2.34 âœ“ â”‚ â”‚ â”‚ $2.08 âœ“ â”‚ â”‚ â”‚âš ï¸$4.15 â”‚  â”‚
â”‚        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š MENU ANALYSIS                           â”‚ ğŸ¤– SUGGESTIONS                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Avg Cost/Meal:    $2.31 (Target: $2.50 âœ“)  â”‚ Friday fish is over budget.      â”‚
â”‚  Protein Variety:  â˜…â˜…â˜…â˜…â˜† Good               â”‚ Try: Tilapia ($2.34) [Apply]     â”‚
â”‚  Color Balance:    â˜…â˜…â˜…â˜†â˜† Needs work         â”‚                                  â”‚
â”‚  Cuisine Spread:   â˜…â˜…â˜…â˜…â˜… Excellent          â”‚ Wednesday needs more color.      â”‚
â”‚  Allergen Status:  âœ“ Complete               â”‚ Add: Roasted Beets [Suggest]     â”‚
â”‚                                                                                 â”‚
â”‚  [ğŸ”„ Auto-generate Diet Extensions] [ğŸ’° Cost Analysis] [ğŸ“‹ Production Sheets]   â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.4.3 Diner Profile View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤ Maria Rodriguez                                  Room 204-A â”‚ Wing B        â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  [Profile â—] [Diet History] [Meal History] [Preferences] [Notes]                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  CURRENT DIET ORDER                 â”‚  CONTACT INFORMATION                 â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚  Primary Diet:    Renal             â”‚  Physician:    Dr. Chen              â”‚ â”‚
â”‚  â”‚  Texture:         Regular           â”‚  Admitted:     Jan 15, 2026          â”‚ â”‚
â”‚  â”‚  Liquids:         Regular           â”‚  Discharge:    Feb 28, 2026 (est)    â”‚ â”‚
â”‚  â”‚  Effective:       Feb 1, 2026       â”‚  Contact:      Son - James (555-1234)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ğŸš¨ ALLERGIES                        ğŸ‘ DISLIKES          ğŸ‘ PREFERENCES    â”‚â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚â”‚
â”‚  â”‚  â€¢ Shellfish (SEVERE)                â€¢ Mushrooms          â€¢ Spicy food      â”‚â”‚
â”‚  â”‚  â€¢ Tree Nuts                         â€¢ Liver              â€¢ Chicken > Beef  â”‚â”‚
â”‚  â”‚                                      â€¢ Brussels Sprouts   â€¢ Mexican cuisine â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â”‚  TODAY'S MEALS                                                       Feb 3, 2026â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  â”‚ Meal      â”‚ Status        â”‚ Items                      â”‚ Time    â”‚ Actions  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â”‚ Breakfast â”‚ âœ“ Delivered   â”‚ Oatmeal, Toast, OJ         â”‚ 8:15 AM â”‚ [View]   â”‚
â”‚  â”‚ Lunch     â”‚ â— Ordered     â”‚ Grilled Chicken, Rice      â”‚ 12:30   â”‚ [Edit]   â”‚
â”‚  â”‚ Dinner    â”‚ â—‹ Pending     â”‚ â€”                          â”‚ 5:30 PM â”‚ [Order]  â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ¤– SMART SUGGESTIONS for Dinner                                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  Based on Renal diet + her preferences + tonight's menu:                        â”‚
â”‚                                                                                 â”‚
â”‚  âœ“ RECOMMENDED                          âš ï¸ AVOID                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ Pork Chop (low K+, moderate protein) â€¢ Beef Stew (high sodium)               â”‚
â”‚  â€¢ Rice Pilaf (renal-friendly starch)   â€¢ Baked Potato (high potassium)         â”‚
â”‚  â€¢ Green Beans (low phosphorus)         â€¢ Banana (high potassium)               â”‚
â”‚                                                                                 â”‚
â”‚  [Apply Recommendations] [Take Custom Order]                                    â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.4.4 Production Dashboard View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¨â€ğŸ³ PRODUCTION HUB                              Feb 3, 2026 â”‚ Dinner Service  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  [Breakfast] [Lunch] [Dinner â—] [Tomorrow â†’]              142 covers expected   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  PRODUCTION TIMELINE                                              5:00 PM NOW â–¼ â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚                                                                                 â”‚
â”‚    3PM      4PM       5PM       6PM       7PM                                   â”‚
â”‚     â”‚        â”‚         â”‚         â”‚         â”‚                                    â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤ Beef Bourguignon (48 portions)              âœ“ Maria             â”‚
â”‚     â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Rice Pilaf (60 portions)          â— Juan              â”‚
â”‚     â”‚        â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Roasted Vegetables (80)   â—‹ Starting          â”‚
â”‚     â”‚        â”‚         â”‚  â”œâ”€â”€â”€â”€â”€â”¤ Dinner Rolls (150)       â—‹ Jose              â”‚
â”‚     â”‚        â”‚         â”‚         â”‚                                              â”‚
â”‚              TARGET    SERVICE                                                  â”‚
â”‚              5:30pm    STARTS                                                   â”‚
â”‚                                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ¯ PREP CHECKLIST                  â”‚  ğŸ“Š DIET BREAKDOWN                   â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚  â˜‘ Mise en place complete           â”‚  Regular:     98 portions (69%)      â”‚ â”‚
â”‚  â”‚  â˜‘ Stock reductions started         â”‚  Diabetic:    22 portions (15%)      â”‚ â”‚
â”‚  â”‚  â˜ Salad greens portioned           â”‚  Low Sodium:  14 portions (10%)      â”‚ â”‚
â”‚  â”‚  â˜ Desserts plated                  â”‚  Pureed:       8 portions  (6%)      â”‚ â”‚
â”‚  â”‚  â˜ Service line set                 â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚ â”‚
â”‚  â”‚                                     â”‚  âš ï¸ Special Alerts: 3 allergies      â”‚ â”‚
â”‚  â”‚  [Auto-generate from Menu]          â”‚  [View Diner Details]                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ¤– CHEF ASSISTANT                                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  ğŸ’¡ "You have 15 lbs excess roasted chicken from lunch.                         â”‚
â”‚      Suggested: Chicken salad for tomorrow's lunch (saves $47)"                 â”‚
â”‚      [Accept & Add to Tomorrow] [View Recipe] [Dismiss]                         â”‚
â”‚                                                                                 â”‚
â”‚  â° "Start vegetable roasting by 4:15 PM to hit service window"                 â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ“‹ HACCP LOG: Last temp check 4:45 PM (Beef: 165Â°F âœ“)    [Log Temperature]     â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.4.5 Inventory Dashboard View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ INVENTORY INTELLIGENCE                                        Main Kitchen  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  [Overview â—] [By Category] [Par Levels] [Receiving] [Physical Count]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  ğŸš¨ REQUIRES ACTION                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  REORDER NOW (4)                    â”‚  EXPIRING SOON (6)                   â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚  Chicken Breast    12 lb (Par: 40)  â”‚  Heavy Cream      3 days   2 qt      â”‚ â”‚
â”‚  â”‚  2% Milk          6 gal (Par: 15)   â”‚  Ground Beef      2 days   8 lb      â”‚ â”‚
â”‚  â”‚  Romaine Lettuce  2 hds (Par: 10)   â”‚  Fresh Berries    1 day    4 pt      â”‚ â”‚
â”‚  â”‚  Olive Oil        0.5 gal (Par: 2)  â”‚  Sliced Turkey    3 days   5 lb      â”‚ â”‚
â”‚  â”‚                                     â”‚                                      â”‚ â”‚
â”‚  â”‚  [Generate PO for All]              â”‚  [View Usage Suggestions]            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ›’ SMART ORDERING                                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  Based on next week's menu + forecast, I recommend:                             â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SYSCO ORDER (Delivers: Thu Feb 6)                   Estimated: $2,847    â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚
â”‚  â”‚  40 lb   Chicken Breast, boneless         @ $3.29/lb    = $131.60         â”‚  â”‚
â”‚  â”‚  25 lb   Ground Beef 80/20                @ $4.89/lb    = $122.25         â”‚  â”‚
â”‚  â”‚  10 cs   Mixed Vegetables, frozen         @ $24.50/cs   = $245.00         â”‚  â”‚
â”‚  â”‚  8 gal   2% Milk                          @ $4.25/gal   = $34.00          â”‚  â”‚
â”‚  â”‚  ... 18 more items                                                        â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚  ğŸ’¡ Tip: Turkey breast is $0.80/lb cheaper this week.                     â”‚  â”‚
â”‚  â”‚     Menu items are compatible. [Swap & Save $32]                          â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚  [Review Full Order] [Approve & Send to Sysco] [Edit Items]               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸš› RECEIVING TODAY                 â”‚  â­ VENDOR SCORECARD                 â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚  ğŸš› Sysco          2:30 PM          â”‚  Sysco        â˜…â˜…â˜…â˜…â˜†  94% on-time     â”‚ â”‚
â”‚  â”‚     14 items â”‚ $1,247               â”‚  Local Farms  â˜…â˜…â˜…â˜…â˜…  100% quality    â”‚ â”‚
â”‚  â”‚  ğŸš› Local Farms    âœ“ Received       â”‚  Seafood Co   â˜…â˜…â˜…â˜†â˜†  2 issues MTD    â”‚ â”‚
â”‚  â”‚     6:00 AM â”‚ 8 items               â”‚                                      â”‚ â”‚
â”‚  â”‚                                     â”‚  [View Analysis]                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 3: Data Model and LLM Notes System

### 3.1 Entity Hierarchy for LLM Context

The system implements hierarchical context aggregation similar to how Cursor uses `.cursorrules` files:

```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚      Tenant         â”‚
                          â”‚  (Organization)     â”‚
                          â”‚                     â”‚
                          â”‚  llm_notes:         â”‚
                          â”‚  "Focus on heart-   â”‚
                          â”‚   healthy options.  â”‚
                          â”‚   Cost target:      â”‚
                          â”‚   $2.50/meal"       â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                   â”‚                   â”‚
                 â–¼                   â–¼                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     Site       â”‚  â”‚     Site       â”‚  â”‚     Site       â”‚
        â”‚ Main Kitchen   â”‚  â”‚   Satellite    â”‚  â”‚    Cafeteria   â”‚
        â”‚                â”‚  â”‚                â”‚  â”‚                â”‚
        â”‚ llm_notes:     â”‚  â”‚ llm_notes:     â”‚  â”‚ llm_notes:     â”‚
        â”‚ "127 residents â”‚  â”‚ "Smaller       â”‚  â”‚ "Staff meals   â”‚
        â”‚  Kosher for    â”‚  â”‚  portions.     â”‚  â”‚  Quick service â”‚
        â”‚  Wing B"       â”‚  â”‚  Limited menu" â”‚  â”‚  options"      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚                   â”‚
        â–¼       â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Station   â”‚ â”‚  Station   â”‚ â”‚ Cycle Menu â”‚
â”‚  Trayline  â”‚ â”‚   Grill    â”‚ â”‚ Spring '26 â”‚
â”‚            â”‚ â”‚            â”‚ â”‚            â”‚
â”‚ llm_notes: â”‚ â”‚ llm_notes: â”‚ â”‚ llm_notes: â”‚
â”‚ "Assembly  â”‚ â”‚ "Temps     â”‚ â”‚ "Emphasize â”‚
â”‚  order:    â”‚ â”‚  logged    â”‚ â”‚  seasonal  â”‚
â”‚  proteinâ†’  â”‚ â”‚  every 2   â”‚ â”‚  produce"  â”‚
â”‚  starchâ†’   â”‚ â”‚  hours"    â”‚ â”‚            â”‚
â”‚  veg"      â”‚ â”‚            â”‚ â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                              â”‚           â”‚
                              â–¼           â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ Menu Item  â”‚ â”‚ Menu Item  â”‚
                       â”‚ Mon Lunch  â”‚ â”‚ Mon Dinner â”‚
                       â”‚            â”‚ â”‚            â”‚
                       â”‚ llm_notes: â”‚ â”‚ llm_notes: â”‚
                       â”‚ "Popular   â”‚ â”‚ "Comfort   â”‚
                       â”‚  with      â”‚ â”‚  food      â”‚
                       â”‚  staff"    â”‚ â”‚  Monday"   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Schema Additions

Add `llm_notes` field to the following tables:

```typescript
// backend/src/db/schema/tenants.ts
export const tenants = sqliteTable('tenants', {
  // ... existing fields ...
  
  /** 
   * LLM context notes for this tenant.
   * These notes are aggregated into agent context when working
   * on any entity within this tenant's hierarchy.
   * 
   * Example content:
   * - Organization-wide dietary philosophies
   * - Budget constraints and targets
   * - Preferred vendors and brands
   * - Cultural or religious considerations
   * - Quality standards and expectations
   */
  llmNotes: text('llm_notes'),
});

export const sites = sqliteTable('sites', {
  // ... existing fields ...
  
  /**
   * LLM context notes for this site.
   * Inherited by all stations, menus, and operations at this location.
   * 
   * Example content:
   * - Site-specific population characteristics
   * - Equipment limitations or capabilities
   * - Local sourcing preferences
   * - Chef preferences and specialties
   * - Regulatory requirements specific to location
   */
  llmNotes: text('llm_notes'),
});

export const stations = sqliteTable('stations', {
  // ... existing fields ...
  
  /**
   * LLM context notes for this station.
   * Applied when working on production or service at this station.
   * 
   * Example content:
   * - Station-specific procedures
   * - Equipment operating notes
   * - HACCP critical control points
   * - Service timing requirements
   */
  llmNotes: text('llm_notes'),
});
```

```typescript
// backend/src/db/schema/menu.ts
export const cycleMenus = sqliteTable('cycle_menus', {
  // ... existing fields ...
  
  /**
   * LLM context notes for this menu cycle.
   * Applied when planning or working with this cycle's meals.
   * 
   * Example content:
   * - Seasonal ingredient focus
   * - Theme or cuisine preferences
   * - Special events or holidays
   * - Budget adjustments for the cycle
   */
  llmNotes: text('llm_notes'),
});

export const menuItems = sqliteTable('menu_items', {
  // ... existing fields ...
  
  /**
   * LLM context notes for this specific menu item placement.
   * Most specific level of context.
   * 
   * Example content:
   * - Why this item was chosen for this day
   * - Expected popularity or concerns
   * - Preparation notes specific to this serving
   * - Pairing recommendations
   */
  llmNotes: text('llm_notes'),
});
```

```typescript
// backend/src/db/schema/diners.ts
export const diners = sqliteTable('diners', {
  // ... existing fields ...
  
  /**
   * LLM context notes for this diner.
   * Critical for personalized meal recommendations.
   * 
   * Example content:
   * - Personal history and preferences beyond structured fields
   * - Family preferences and visiting patterns
   * - Behavioral notes (e.g., "prefers to eat in room")
   * - Communication preferences
   */
  llmNotes: text('llm_notes'),
});
```

```typescript
// backend/src/db/schema/recipes.ts
export const recipes = sqliteTable('recipes', {
  // ... existing fields ...
  
  /**
   * LLM context notes for this recipe.
   * Provides institutional knowledge about recipe.
   * 
   * Example content:
   * - Chef tips and secrets
   * - Common mistakes to avoid
   * - Successful variations
   * - Resident feedback history
   * - Best occasions for this dish
   */
  llmNotes: text('llm_notes'),
});
```

### 3.3 Context Aggregation Service

```typescript
// backend/src/services/llm-context.service.ts

interface LLMContextResult {
  /** Combined context string for LLM system prompt */
  systemContext: string;
  
  /** Individual context sources for display */
  sources: ContextSource[];
  
  /** Total token estimate */
  estimatedTokens: number;
}

interface ContextSource {
  entityType: string;
  entityId: string;
  entityName: string;
  notes: string;
  depth: number;
}

/**
 * Aggregates llm_notes from entity hierarchy into a single context.
 * Similar to how Cursor aggregates .cursorrules files.
 */
export async function aggregateLLMContext(
  entityType: string,
  entityId: string,
  db: Database
): Promise<LLMContextResult> {
  const sources: ContextSource[] = [];
  
  // Build path from entity to root tenant
  const hierarchy = await buildEntityHierarchy(entityType, entityId, db);
  
  // Collect notes from each level (root to leaf)
  for (const entity of hierarchy) {
    if (entity.llmNotes) {
      sources.push({
        entityType: entity.type,
        entityId: entity.id,
        entityName: entity.name,
        notes: entity.llmNotes,
        depth: entity.depth,
      });
    }
  }
  
  // Format for system prompt
  const systemContext = formatContextForPrompt(sources);
  
  return {
    systemContext,
    sources,
    estimatedTokens: estimateTokens(systemContext),
  };
}

function formatContextForPrompt(sources: ContextSource[]): string {
  if (sources.length === 0) {
    return '';
  }
  
  let context = '## Operational Context\n\n';
  context += 'The following guidelines apply to this operation:\n\n';
  
  for (const source of sources) {
    context += `### ${source.entityType}: ${source.entityName}\n`;
    context += `${source.notes}\n\n`;
  }
  
  return context;
}

async function buildEntityHierarchy(
  entityType: string,
  entityId: string,
  db: Database
): Promise<HierarchyNode[]> {
  const hierarchy: HierarchyNode[] = [];
  let currentType = entityType;
  let currentId = entityId;
  let depth = 0;
  
  while (currentType && currentId) {
    const entity = await fetchEntity(currentType, currentId, db);
    if (!entity) break;
    
    hierarchy.unshift({
      type: currentType,
      id: currentId,
      name: entity.name,
      llmNotes: entity.llmNotes,
      depth: depth++,
    });
    
    // Navigate to parent
    const parent = getParentReference(currentType, entity);
    currentType = parent?.type;
    currentId = parent?.id;
  }
  
  return hierarchy;
}

/**
 * Defines parent relationships for context traversal.
 */
function getParentReference(
  entityType: string, 
  entity: any
): { type: string; id: string } | null {
  const parentMap: Record<string, (e: any) => { type: string; id: string } | null> = {
    'menu_item': (e) => e.cycleMenuId ? { type: 'cycle_menu', id: e.cycleMenuId } : null,
    'cycle_menu': (e) => e.siteId ? { type: 'site', id: e.siteId } : 
                         e.tenantId ? { type: 'tenant', id: e.tenantId } : null,
    'station': (e) => e.siteId ? { type: 'site', id: e.siteId } : null,
    'site': (e) => e.tenantId ? { type: 'tenant', id: e.tenantId } : null,
    'diner': (e) => e.siteId ? { type: 'site', id: e.siteId } : null,
    'recipe': (e) => e.tenantId ? { type: 'tenant', id: e.tenantId } : null,
    'employee': (e) => e.primarySiteId ? { type: 'site', id: e.primarySiteId } : null,
    'production_schedule': (e) => e.siteId ? { type: 'site', id: e.siteId } : null,
    'tenant': () => null, // Root level
  };
  
  const resolver = parentMap[entityType];
  return resolver ? resolver(entity) : null;
}
```

### 3.4 Example Context Aggregation

When an agent is working on a **Menu Item** (Monday Lunch EntrÃ©e in Spring 2026 Cycle at Main Kitchen for Sunrise Senior Living):

**Aggregated Context:**

```markdown
## Operational Context

The following guidelines apply to this operation:

### Tenant: Sunrise Senior Living
- Focus on heart-healthy options across all facilities
- Target food cost: $2.50 per meal maximum
- Preferred vendors: Sysco (primary), US Foods (backup), Local Farms Co (produce)
- Avoid excessive sodium - many residents on cardiac diets
- Cultural considerations: Large Jewish population in Wing B requires kosher options

### Site: Main Campus Kitchen
- Serves 127 active residents across 3 wings
- Wing B requires kosher meal options (42 residents)
- Chef Maria prefers batch cooking methods for efficiency
- Equipment note: Convection oven 2 runs hot - reduce temp by 25Â°F
- Local sourcing encouraged when cost-effective

### Cycle Menu: Spring 2026
- Emphasize seasonal spring vegetables (asparagus, peas, artichokes)
- Reduce red meat frequency to 2x per week max (resident feedback)
- Easter week (Week 3): plan special brunch menu
- Budget slightly relaxed this cycle due to grant funding

### Menu Item: Monday Lunch EntrÃ©e
- Grilled chicken historically popular on Mondays (staff present)
- Consider lighter option - many residents have weekend visitors who bring treats
- Production note: Scale for 15% higher attendance (family visits)
```

---

## Part 4: Agent System and Tool Definitions

### 4.1 Agent Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AGENT SYSTEM                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         USER INPUT                                       â”‚   â”‚
â”‚  â”‚  â€¢ Text chat message                                                     â”‚   â”‚
â”‚  â”‚  â€¢ Voice transcription                                                   â”‚   â”‚
â”‚  â”‚  â€¢ File attachment (images, documents)                                   â”‚   â”‚
â”‚  â”‚  â€¢ Quick action buttons                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                             â”‚
â”‚                                   â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    CONTEXT AGGREGATION                                   â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Current      â”‚  â”‚ LLM Notes    â”‚  â”‚ Selected     â”‚  â”‚ Conversation â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Entity       â”‚  â”‚ Hierarchy    â”‚  â”‚ Entity Data  â”‚  â”‚ History      â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                             â”‚
â”‚                                   â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         LLM PROCESSING                                   â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  Model: Claude 3.5 Sonnet / GPT-4                                       â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  System Prompt:                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ You are a kitchen management assistant for {tenant_name}.          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ You help with menu planning, inventory, production, and dietary    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ compliance.                                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ {aggregated_llm_notes_context}                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ You have access to the following tools:                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ {tool_definitions}                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                             â”‚
â”‚                                   â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         TOOL EXECUTION                                   â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚   â”‚
â”‚  â”‚  â”‚ Tool Request   â”‚â”€â”€â”                                                  â”‚   â”‚
â”‚  â”‚  â”‚ from LLM       â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”œâ”€â”€â”€â”€â–¶â”‚         TOOL ROUTER                 â”‚     â”‚   â”‚
â”‚  â”‚                      â”‚     â”‚                                     â”‚     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚  Core Data â”‚ Algorithms â”‚ External  â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ Tool Result    â”‚â—€â”€â”˜     â”‚    Tools   â”‚   Tools    â”‚   Tools   â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ to LLM         â”‚        â”‚            â”‚            â”‚           â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                             â”‚
â”‚                                   â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         RESPONSE GENERATION                              â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  â€¢ Formatted text response                                               â”‚   â”‚
â”‚  â”‚  â€¢ Embedded action buttons                                               â”‚   â”‚
â”‚  â”‚  â€¢ Data visualizations                                                   â”‚   â”‚
â”‚  â”‚  â€¢ Tool execution log (collapsible)                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Complete Tool Catalog

#### 4.2.1 Core Data Tools

```typescript
// Tool: db_query
{
  name: "db_query",
  description: "Query the database using natural language. Returns structured results.",
  parameters: {
    type: "object",
    properties: {
      query: {
        type: "string",
        description: "Natural language query (e.g., 'Find all diners with renal diet')"
      },
      entityType: {
        type: "string",
        enum: ["diner", "recipe", "ingredient", "menu_item", "inventory", 
               "production_schedule", "vendor", "purchase_order"],
        description: "Optional: limit search to specific entity type"
      },
      limit: {
        type: "number",
        description: "Maximum results to return (default: 20)"
      }
    },
    required: ["query"]
  },
  returns: {
    type: "array",
    items: { type: "object" },
    description: "Array of matching entities with relevant fields"
  }
}

// Tool: db_get
{
  name: "db_get",
  description: "Get a specific entity by ID with full details.",
  parameters: {
    type: "object",
    properties: {
      entityType: {
        type: "string",
        enum: ["tenant", "site", "station", "employee", "diner", "recipe", 
               "ingredient", "cycle_menu", "menu_item", "vendor", "purchase_order",
               "inventory", "production_schedule", "forecast"],
        description: "Type of entity to retrieve"
      },
      entityId: {
        type: "string",
        description: "Unique identifier of the entity"
      },
      includeRelated: {
        type: "boolean",
        description: "Include related entities (e.g., recipe ingredients)"
      }
    },
    required: ["entityType", "entityId"]
  }
}

// Tool: db_create
{
  name: "db_create",
  description: "Create a new entity in the database.",
  parameters: {
    type: "object",
    properties: {
      entityType: {
        type: "string",
        description: "Type of entity to create"
      },
      data: {
        type: "object",
        description: "Entity data fields"
      }
    },
    required: ["entityType", "data"]
  }
}

// Tool: db_update
{
  name: "db_update",
  description: "Update an existing entity.",
  parameters: {
    type: "object",
    properties: {
      entityType: { type: "string" },
      entityId: { type: "string" },
      data: { type: "object" }
    },
    required: ["entityType", "entityId", "data"]
  }
}

// Tool: schema_inspect
{
  name: "schema_inspect",
  description: "Get schema information for an entity type (fields, types, relationships).",
  parameters: {
    type: "object",
    properties: {
      entityType: { type: "string" }
    },
    required: ["entityType"]
  }
}
```

#### 4.2.2 Algorithm Tools

```typescript
// Tool: recipe_scale
{
  name: "recipe_scale",
  description: "Scale a recipe to a target yield with practical measurements.",
  parameters: {
    type: "object",
    properties: {
      recipeId: {
        type: "string",
        description: "Recipe to scale"
      },
      targetYield: {
        type: "number", 
        description: "Desired number of portions"
      },
      roundToFractions: {
        type: "boolean",
        default: true,
        description: "Round to practical fractions (1/4, 1/3, 1/2, etc.)"
      }
    },
    required: ["recipeId", "targetYield"]
  },
  returns: {
    scaledIngredients: "Array of scaled ingredients with practical measurements",
    scaleFactor: "Multiplier applied",
    warnings: "Any scaling concerns (e.g., seasoning adjustments for large batches)"
  }
}

// Tool: recipe_cost
{
  name: "recipe_cost",
  description: "Calculate current cost of a recipe based on inventory prices.",
  parameters: {
    type: "object",
    properties: {
      recipeId: { type: "string" },
      yield: { type: "number", description: "Optional yield override" }
    },
    required: ["recipeId"]
  },
  returns: {
    totalCost: "Total recipe cost",
    costPerPortion: "Cost per serving",
    ingredientBreakdown: "Cost by ingredient",
    mostExpensive: "Top 3 cost drivers"
  }
}

// Tool: protein_spread
{
  name: "protein_spread",
  description: "Generate a protein rotation schedule for menu planning.",
  parameters: {
    type: "object",
    properties: {
      cycleDays: {
        type: "number",
        description: "Number of days in menu cycle"
      },
      mealsPerDay: {
        type: "number",
        description: "Meals requiring protein (typically 2: lunch, dinner)"
      },
      preferences: {
        type: "array",
        items: {
          type: "object",
          properties: {
            protein: { type: "string" },
            preferenceScore: { type: "number", min: 1, max: 5 },
            maxPerWeek: { type: "number" }
          }
        },
        description: "Protein preferences and constraints"
      },
      constraints: {
        type: "object",
        properties: {
          minDaysBetweenSame: { type: "number", default: 2 },
          requireVegetarianOption: { type: "boolean", default: true }
        }
      }
    },
    required: ["cycleDays", "mealsPerDay"]
  },
  returns: {
    schedule: "Day-by-day protein assignments",
    varietyScore: "0-100 diversity rating",
    violations: "Any constraint violations"
  }
}

// Tool: forecast_demand
{
  name: "forecast_demand",
  description: "Predict demand for a menu item or meal period.",
  parameters: {
    type: "object",
    properties: {
      siteId: { type: "string" },
      date: { type: "string", format: "date" },
      mealPeriodId: { type: "string" },
      recipeId: { 
        type: "string",
        description: "Optional: forecast for specific item vs. total census"
      },
      method: {
        type: "string",
        enum: ["moving_average", "exponential_smoothing", "ensemble"],
        default: "ensemble"
      }
    },
    required: ["siteId", "date", "mealPeriodId"]
  },
  returns: {
    predictedCount: "Forecasted portions/covers",
    confidenceInterval: "[low, high] range",
    factors: "Adjustment factors applied (weather, day of week, etc.)"
  }
}

// Tool: validate_diet
{
  name: "validate_diet",
  description: "Check if a recipe/menu item is compatible with a diet type.",
  parameters: {
    type: "object",
    properties: {
      recipeId: { type: "string" },
      dietTypeId: { type: "string" },
      dinerId: { 
        type: "string",
        description: "Optional: also check diner's specific allergies/restrictions"
      }
    },
    required: ["recipeId", "dietTypeId"]
  },
  returns: {
    isCompatible: "boolean",
    violations: "List of diet violations",
    allergenFlags: "Allergen warnings if dinerId provided",
    modifications: "Suggested modifications to make compatible"
  }
}

// Tool: cost_optimize
{
  name: "cost_optimize",
  description: "Suggest cost optimizations for a menu or recipe.",
  parameters: {
    type: "object",
    properties: {
      targetType: {
        type: "string",
        enum: ["recipe", "menu_week", "cycle_menu"]
      },
      targetId: { type: "string" },
      budgetTarget: { 
        type: "number",
        description: "Target cost per portion"
      },
      constraints: {
        type: "object",
        properties: {
          maintainProtein: { type: "boolean", default: true },
          allowSubstitutions: { type: "boolean", default: true },
          maxQualityImpact: { 
            type: "string", 
            enum: ["none", "minimal", "moderate"],
            default: "minimal"
          }
        }
      }
    },
    required: ["targetType", "targetId", "budgetTarget"]
  },
  returns: {
    currentCost: "Current cost per portion",
    optimizedCost: "Projected cost after changes",
    suggestions: "Ranked list of optimization opportunities",
    totalSavings: "Potential savings"
  }
}

// Tool: generate_production_schedule
{
  name: "generate_production_schedule",
  description: "Create a production schedule for a meal service.",
  parameters: {
    type: "object",
    properties: {
      siteId: { type: "string" },
      date: { type: "string", format: "date" },
      mealPeriodId: { type: "string" },
      serviceTime: { 
        type: "string", 
        format: "time",
        description: "Target service start time"
      }
    },
    required: ["siteId", "date", "mealPeriodId"]
  },
  returns: {
    scheduleItems: "Timed production tasks",
    criticalPath: "Items that determine minimum time",
    equipmentAllocation: "Equipment assignments",
    staffAssignments: "Suggested employee assignments"
  }
}

// Tool: analyze_leftovers
{
  name: "analyze_leftovers",
  description: "Analyze leftover patterns and suggest repurposing.",
  parameters: {
    type: "object",
    properties: {
      siteId: { type: "string" },
      dateRange: {
        type: "object",
        properties: {
          start: { type: "string", format: "date" },
          end: { type: "string", format: "date" }
        }
      },
      recipeId: { 
        type: "string",
        description: "Optional: analyze specific recipe"
      }
    },
    required: ["siteId"]
  },
  returns: {
    wastePatterns: "Recipes with high leftover rates",
    repurposeSuggestions: "Recipes that can use leftovers",
    forecastAccuracy: "How well forecasts matched actuals",
    costImpact: "Financial impact of waste"
  }
}

// Tool: check_allergens
{
  name: "check_allergens",
  description: "Check a recipe or menu for allergen presence.",
  parameters: {
    type: "object",
    properties: {
      recipeId: { type: "string" },
      allergensToCheck: {
        type: "array",
        items: { type: "string" },
        description: "Specific allergens to check (default: all major allergens)"
      }
    },
    required: ["recipeId"]
  },
  returns: {
    containsAllergens: "List of allergens present",
    crossContactRisks: "Potential cross-contamination risks",
    safeForDiets: "Diet types this recipe is safe for"
  }
}

// Tool: suggest_menu_items
{
  name: "suggest_menu_items",
  description: "Get recipe suggestions for a menu slot based on criteria.",
  parameters: {
    type: "object",
    properties: {
      mealPeriod: { type: "string" },
      category: { 
        type: "string",
        enum: ["EntrÃ©e", "Starch", "Vegetable", "Salad", "Soup", "Dessert"]
      },
      constraints: {
        type: "object",
        properties: {
          maxCost: { type: "number" },
          cuisineType: { type: "string" },
          proteinType: { type: "string" },
          excludeRecent: { 
            type: "number",
            description: "Exclude recipes served in last N days"
          },
          dietCompatible: { type: "array", items: { type: "string" } }
        }
      },
      count: { type: "number", default: 5 }
    },
    required: ["mealPeriod", "category"]
  }
}
```

#### 4.2.3 External Integration Tools

```typescript
// Tool: weather_get
{
  name: "weather_get",
  description: "Get weather forecast for production planning.",
  parameters: {
    type: "object",
    properties: {
      location: { 
        type: "string",
        description: "City or zip code (default: site location)"
      },
      date: { type: "string", format: "date" }
    },
    required: ["date"]
  },
  returns: {
    temperature: "High/low temps",
    conditions: "Weather description",
    precipitation: "Rain/snow chance",
    productionImpact: "Suggested menu adjustments"
  }
}

// Tool: seasonal_produce
{
  name: "seasonal_produce",
  description: "Get what's in season for a region and time.",
  parameters: {
    type: "object",
    properties: {
      region: {
        type: "string",
        description: "Geographic region (default: site region)"
      },
      month: {
        type: "number",
        min: 1, max: 12,
        description: "Month to check (default: current)"
      },
      category: {
        type: "string",
        enum: ["all", "vegetables", "fruits", "herbs"],
        default: "all"
      }
    }
  },
  returns: {
    peakSeason: "Items at peak availability/quality",
    available: "Items in season",
    ending: "Items going out of season soon"
  }
}

// Tool: sysco_search
{
  name: "sysco_search",
  description: "Search Sysco product catalog.",
  parameters: {
    type: "object",
    properties: {
      query: { type: "string" },
      category: { type: "string" },
      maxPrice: { type: "number" },
      brandPreference: { type: "string" }
    },
    required: ["query"]
  },
  returns: {
    products: "Matching products with prices and specs",
    alternatives: "Lower-cost alternatives"
  }
}

// Tool: sysco_order
{
  name: "sysco_order",
  description: "Create or submit a Sysco order.",
  parameters: {
    type: "object",
    properties: {
      action: {
        type: "string",
        enum: ["create_draft", "add_item", "submit", "get_status"]
      },
      orderId: { type: "string" },
      items: {
        type: "array",
        items: {
          type: "object",
          properties: {
            productId: { type: "string" },
            quantity: { type: "number" },
            unit: { type: "string" }
          }
        }
      },
      deliveryDate: { type: "string", format: "date" }
    },
    required: ["action"]
  }
}

// Tool: browser_navigate
{
  name: "browser_navigate",
  description: "Navigate to a web page for information retrieval or automation.",
  parameters: {
    type: "object",
    properties: {
      url: { type: "string" },
      action: {
        type: "string",
        enum: ["read", "screenshot", "interact"],
        default: "read"
      },
      selector: {
        type: "string",
        description: "CSS selector for specific content"
      }
    },
    required: ["url"]
  }
}

// Tool: ehr_get_diet
{
  name: "ehr_get_diet",
  description: "Get current diet order from electronic health record.",
  parameters: {
    type: "object",
    properties: {
      patientId: { type: "string" },
      includeHistory: { type: "boolean", default: false }
    },
    required: ["patientId"]
  },
  returns: {
    currentDiet: "Active diet order",
    restrictions: "Additional restrictions",
    allergies: "Documented allergies",
    lastUpdated: "When diet order was last changed"
  }
}
```

### 4.3 Agent Personalities/Modes

The agent can operate in different modes optimized for specific roles:

```typescript
interface AgentPersonality {
  id: string;
  name: string;
  icon: string;
  systemPromptAddition: string;
  defaultTools: string[];
  suggestedActions: string[];
}

const agentPersonalities: AgentPersonality[] = [
  {
    id: 'chef_assistant',
    name: 'Chef Assistant',
    icon: 'ğŸ‘¨â€ğŸ³',
    systemPromptAddition: `
      You are assisting the chef with production and recipe matters.
      Focus on:
      - Recipe scaling and preparation
      - Production timing and scheduling
      - Ingredient substitutions
      - Leftover utilization
      - Quality and presentation
      
      Be practical and kitchen-focused. Speak in culinary terms.
    `,
    defaultTools: ['recipe_scale', 'recipe_cost', 'generate_production_schedule', 
                   'analyze_leftovers', 'suggest_menu_items'],
    suggestedActions: [
      "What's the production schedule for today?",
      "Scale this recipe for 80 portions",
      "What can I make with leftover chicken?"
    ]
  },
  {
    id: 'dietitian',
    name: 'Clinical Dietitian',
    icon: 'ğŸ¥—',
    systemPromptAddition: `
      You are assisting the clinical dietitian with therapeutic diets.
      Focus on:
      - Diet compliance and restrictions
      - Allergen safety
      - Nutritional adequacy
      - Patient-specific recommendations
      - Medical nutrition therapy
      
      Be precise about dietary restrictions. Patient safety is paramount.
    `,
    defaultTools: ['validate_diet', 'check_allergens', 'db_query', 
                   'ehr_get_diet', 'suggest_menu_items'],
    suggestedActions: [
      "Check this menu for renal diet compliance",
      "Which residents have diet changes today?",
      "Suggest lunch options for diabetic diets"
    ]
  },
  {
    id: 'operations_manager',
    name: 'Operations Manager',
    icon: 'ğŸ“Š',
    systemPromptAddition: `
      You are assisting the food service manager with operations.
      Focus on:
      - Cost control and budgeting
      - Inventory management
      - Vendor relationships
      - Staff scheduling
      - Compliance and documentation
      
      Be data-driven and cost-conscious. Highlight actionable insights.
    `,
    defaultTools: ['cost_optimize', 'forecast_demand', 'sysco_search', 
                   'analyze_leftovers', 'db_query'],
    suggestedActions: [
      "What's our food cost this week?",
      "Generate purchase order for next week",
      "Which items are over budget?"
    ]
  },
  {
    id: 'procurement',
    name: 'Procurement Specialist',
    icon: 'ğŸ›’',
    systemPromptAddition: `
      You are assisting with purchasing and vendor management.
      Focus on:
      - Price comparison and optimization
      - Order generation and tracking
      - Vendor performance
      - Inventory par levels
      - Receiving and quality
      
      Optimize for value (price + quality + reliability).
    `,
    defaultTools: ['sysco_search', 'sysco_order', 'db_query', 
                   'cost_optimize', 'browser_navigate'],
    suggestedActions: [
      "What needs to be ordered this week?",
      "Compare prices for chicken breast",
      "Check Sysco order status"
    ]
  }
];
```

---

## Part 5: Algorithm Library

### 5.1 Algorithm Index

The following algorithms from [algorithms.md](algorithms.md) are exposed as agent tools:

| Algorithm | Tool Name | Category | Description |
|-----------|-----------|----------|-------------|
| Census Forecasting | `forecast_demand` | Forecasting | Predict meal counts using exponential smoothing |
| Menu Item Selection | `forecast_demand` | Forecasting | Predict specific item selections |
| Protein Spreading | `protein_spread` | Menu Planning | Ensure protein variety across cycle |
| Color Balance | `analyze_menu` | Menu Planning | Check visual appeal of meals |
| Cuisine Diversity | `analyze_menu` | Menu Planning | Ensure cuisine variety |
| Diet Extensions | `generate_diet_extension` | Menu Planning | Auto-generate modified diets |
| Factor Scaling | `recipe_scale` | Recipe | Scale recipes with practical measures |
| Recipe Costing | `recipe_cost` | Recipe | Calculate ingredient costs |
| Unit Conversion | (internal) | Recipe | Convert between units |
| Par Level Calc | `calculate_par_levels` | Inventory | Determine reorder points |
| EOQ | `calculate_eoq` | Inventory | Optimal order quantities |
| FIFO Tracking | `get_inventory_lots` | Inventory | Track lot expiration |
| Production Schedule | `generate_production_schedule` | Production | Create timed prep lists |
| Equipment Schedule | `generate_production_schedule` | Production | Allocate equipment |
| Allergen Detection | `check_allergens` | Compliance | Find allergens in recipes |
| Diet Validation | `validate_diet` | Compliance | Check diet compatibility |
| Nutrient Checking | `check_nutrients` | Compliance | Verify nutritional limits |
| Leftover Prediction | `analyze_leftovers` | Waste | Predict excess production |
| Repurposing | `suggest_repurpose` | Waste | Match leftovers to recipes |
| PO Generation | `generate_purchase_order` | Procurement | Create orders from forecast |
| Price Comparison | `compare_vendor_prices` | Procurement | Find best values |
| Substitution | `suggest_substitutions` | Procurement | Find ingredient alternatives |

### 5.2 Algorithm Implementation Pattern

All algorithms follow a consistent pattern for agent invocation:

```typescript
// backend/src/algorithms/index.ts

import { z } from 'zod';

/**
 * Base interface for algorithm tools.
 * Follows MCP (Model Context Protocol) tool specification pattern.
 */
export interface AlgorithmTool<TInput, TOutput> {
  /** Unique tool identifier */
  name: string;
  
  /** Human-readable description for LLM */
  description: string;
  
  /** JSON Schema for input validation */
  inputSchema: z.ZodType<TInput>;
  
  /** Execute the algorithm */
  execute: (input: TInput, context: ExecutionContext) => Promise<TOutput>;
  
  /** Example invocations for few-shot prompting */
  examples: ToolExample[];
}

interface ExecutionContext {
  tenantId: string;
  siteId?: string;
  userId: string;
  db: Database;
}

interface ToolExample {
  input: Record<string, any>;
  output: Record<string, any>;
  description: string;
}

/**
 * Registry of all available algorithm tools.
 */
export const algorithmTools: Map<string, AlgorithmTool<any, any>> = new Map();

/**
 * Register an algorithm as a callable tool.
 */
export function registerTool<TInput, TOutput>(
  tool: AlgorithmTool<TInput, TOutput>
): void {
  algorithmTools.set(tool.name, tool);
}

/**
 * Execute a tool by name with input validation.
 */
export async function executeTool(
  toolName: string,
  input: unknown,
  context: ExecutionContext
): Promise<{ success: boolean; result?: any; error?: string }> {
  const tool = algorithmTools.get(toolName);
  
  if (!tool) {
    return { success: false, error: `Unknown tool: ${toolName}` };
  }
  
  // Validate input
  const parseResult = tool.inputSchema.safeParse(input);
  if (!parseResult.success) {
    return { 
      success: false, 
      error: `Invalid input: ${parseResult.error.message}` 
    };
  }
  
  try {
    const result = await tool.execute(parseResult.data, context);
    return { success: true, result };
  } catch (error) {
    return { 
      success: false, 
      error: error instanceof Error ? error.message : 'Execution failed' 
    };
  }
}
```

### 5.3 Example Algorithm Implementation

```typescript
// backend/src/algorithms/protein-spread.ts

import { z } from 'zod';
import { AlgorithmTool, registerTool } from './index';

const inputSchema = z.object({
  cycleDays: z.number().min(7).max(56),
  mealsPerDay: z.number().min(1).max(3).default(2),
  preferences: z.array(z.object({
    protein: z.string(),
    preferenceScore: z.number().min(1).max(5),
    maxPerWeek: z.number().optional(),
  })).optional(),
  constraints: z.object({
    minDaysBetweenSame: z.number().default(2),
    maxPerWeek: z.record(z.number()).optional(),
    requireVegetarian: z.boolean().default(true),
  }).optional(),
});

type ProteinSpreadInput = z.infer<typeof inputSchema>;

interface ProteinSpreadOutput {
  schedule: Array<{
    day: number;
    meal: string;
    protein: string;
  }>;
  varietyScore: number;
  violations: string[];
  suggestions: string[];
}

const proteinSpreadTool: AlgorithmTool<ProteinSpreadInput, ProteinSpreadOutput> = {
  name: 'protein_spread',
  
  description: `Generate a protein rotation schedule for menu planning that ensures variety.
  
  Considers:
  - Minimum days between same protein (default: 2)
  - Maximum frequency per week per protein
  - User preferences (higher score = more frequent)
  - Vegetarian option requirements
  
  Returns a day-by-day schedule with variety scoring.`,
  
  inputSchema,
  
  async execute(input, context): Promise<ProteinSpreadOutput> {
    const { cycleDays, mealsPerDay, preferences, constraints } = input;
    
    // Default proteins if none specified
    const proteins = preferences?.map(p => p.protein) ?? [
      'Beef', 'Poultry', 'Pork', 'Seafood', 'Vegetarian'
    ];
    
    const schedule: ProteinSpreadOutput['schedule'] = [];
    const violations: string[] = [];
    const lastUsed = new Map<string, number>();
    const weeklyCount = new Map<string, number>();
    
    // Generate schedule
    for (let day = 1; day <= cycleDays; day++) {
      const week = Math.ceil(day / 7);
      
      // Reset weekly counts at start of each week
      if ((day - 1) % 7 === 0) {
        weeklyCount.clear();
      }
      
      for (let meal = 0; meal < mealsPerDay; meal++) {
        const mealName = meal === 0 ? 'Lunch' : 'Dinner';
        
        // Find eligible proteins
        const eligible = proteins.filter(protein => {
          // Check minimum days between
          const lastDay = lastUsed.get(protein) ?? -100;
          const daysSince = day - lastDay;
          const minDays = constraints?.minDaysBetweenSame ?? 2;
          if (daysSince < minDays) return false;
          
          // Check weekly maximum
          const weekCount = weeklyCount.get(protein) ?? 0;
          const maxPerWeek = constraints?.maxPerWeek?.[protein] ?? 3;
          if (weekCount >= maxPerWeek) return false;
          
          return true;
        });
        
        if (eligible.length === 0) {
          // Constraint violation - use least recently used
          const lru = [...proteins].sort((a, b) => 
            (lastUsed.get(a) ?? 0) - (lastUsed.get(b) ?? 0)
          )[0];
          
          violations.push(`Day ${day} ${mealName}: No eligible protein, used ${lru}`);
          schedule.push({ day, meal: mealName, protein: lru });
          lastUsed.set(lru, day);
          weeklyCount.set(lru, (weeklyCount.get(lru) ?? 0) + 1);
        } else {
          // Select based on preference score
          const prefs = preferences ?? proteins.map(p => ({ 
            protein: p, 
            preferenceScore: 3 
          }));
          
          const weighted = eligible.map(protein => {
            const pref = prefs.find(p => p.protein === protein);
            return { protein, weight: pref?.preferenceScore ?? 3 };
          });
          
          // Weighted random selection
          const totalWeight = weighted.reduce((sum, w) => sum + w.weight, 0);
          let random = Math.random() * totalWeight;
          let selected = weighted[0].protein;
          
          for (const w of weighted) {
            random -= w.weight;
            if (random <= 0) {
              selected = w.protein;
              break;
            }
          }
          
          schedule.push({ day, meal: mealName, protein: selected });
          lastUsed.set(selected, day);
          weeklyCount.set(selected, (weeklyCount.get(selected) ?? 0) + 1);
        }
      }
    }
    
    // Calculate variety score
    const proteinCounts = new Map<string, number>();
    for (const item of schedule) {
      proteinCounts.set(item.protein, (proteinCounts.get(item.protein) ?? 0) + 1);
    }
    
    const totalSlots = schedule.length;
    const idealPerProtein = totalSlots / proteins.length;
    let deviation = 0;
    
    for (const protein of proteins) {
      const actual = proteinCounts.get(protein) ?? 0;
      deviation += Math.abs(actual - idealPerProtein);
    }
    
    const maxDeviation = idealPerProtein * proteins.length;
    const varietyScore = Math.round(100 * (1 - deviation / maxDeviation));
    
    // Generate suggestions
    const suggestions: string[] = [];
    
    for (const [protein, count] of proteinCounts) {
      const percentage = (count / totalSlots) * 100;
      if (percentage > 30) {
        suggestions.push(`${protein} is used ${percentage.toFixed(0)}% of the time - consider reducing`);
      }
      if (percentage < 10) {
        suggestions.push(`${protein} is underutilized (${percentage.toFixed(0)}%) - consider increasing`);
      }
    }
    
    return {
      schedule,
      varietyScore,
      violations,
      suggestions,
    };
  },
  
  examples: [
    {
      description: "Generate 4-week cycle with default proteins",
      input: {
        cycleDays: 28,
        mealsPerDay: 2
      },
      output: {
        schedule: [
          { day: 1, meal: "Lunch", protein: "Poultry" },
          { day: 1, meal: "Dinner", protein: "Beef" },
          // ... etc
        ],
        varietyScore: 85,
        violations: [],
        suggestions: []
      }
    }
  ]
};

// Register the tool
registerTool(proteinSpreadTool);
```

---

## Part 6: External Integrations

### 6.1 Integration Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           EXTERNAL INTEGRATIONS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Weather API    â”‚  â”‚  Seasonal Data   â”‚  â”‚    EHR/EMR       â”‚              â”‚
â”‚  â”‚   (OpenWeather)  â”‚  â”‚  (USDA/Custom)   â”‚  â”‚   (HL7 FHIR)     â”‚              â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚              â”‚
â”‚  â”‚  â€¢ Forecast      â”‚  â”‚  â€¢ In-season     â”‚  â”‚  â€¢ Diet orders   â”‚              â”‚
â”‚  â”‚  â€¢ Temperature   â”‚  â”‚    produce       â”‚  â”‚  â€¢ Allergies     â”‚              â”‚
â”‚  â”‚  â€¢ Precipitation â”‚  â”‚  â€¢ Peak quality  â”‚  â”‚  â€¢ Restrictions  â”‚              â”‚
â”‚  â”‚                  â”‚  â”‚  â€¢ Local sourcingâ”‚  â”‚  â€¢ NPO status    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚           â”‚                     â”‚                     â”‚                        â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                 â”‚                                              â”‚
â”‚                                 â–¼                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                    â”‚    Integration Layer    â”‚                                 â”‚
â”‚                    â”‚    (Adapters + Cache)   â”‚                                 â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                 â”‚                                              â”‚
â”‚                                 â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Food          â”‚  â”‚   Browser        â”‚  â”‚   Notifications  â”‚              â”‚
â”‚  â”‚   Distributors  â”‚  â”‚   Automation     â”‚  â”‚   (Webhooks)     â”‚              â”‚
â”‚  â”‚                 â”‚  â”‚   (Playwright)   â”‚  â”‚                  â”‚              â”‚
â”‚  â”‚  â€¢ Sysco API    â”‚  â”‚                  â”‚  â”‚  â€¢ Slack         â”‚              â”‚
â”‚  â”‚  â€¢ US Foods     â”‚  â”‚  â€¢ Web scraping  â”‚  â”‚  â€¢ Email         â”‚              â”‚
â”‚  â”‚  â€¢ Local vendorsâ”‚  â”‚  â€¢ Form filling  â”‚  â”‚  â€¢ SMS           â”‚              â”‚
â”‚  â”‚                 â”‚  â”‚  â€¢ Order submit  â”‚  â”‚  â€¢ Push          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Weather Integration

```typescript
// backend/src/integrations/weather.ts

interface WeatherForecast {
  date: string;
  location: string;
  high: number;
  low: number;
  conditions: string;
  precipitation: number;
  humidity: number;
}

interface ProductionImpact {
  impactLevel: 'none' | 'low' | 'moderate' | 'high';
  recommendations: string[];
}

export class WeatherService {
  private apiKey: string;
  private cache: Map<string, { data: WeatherForecast; expiry: number }>;
  
  constructor(apiKey: string) {
    this.apiKey = apiKey;
    this.cache = new Map();
  }
  
  async getForecast(location: string, date: string): Promise<WeatherForecast> {
    const cacheKey = `${location}:${date}`;
    const cached = this.cache.get(cacheKey);
    
    if (cached && cached.expiry > Date.now()) {
      return cached.data;
    }
    
    // Call OpenWeatherMap API
    const response = await fetch(
      `https://api.openweathermap.org/data/2.5/forecast?` +
      `q=${encodeURIComponent(location)}&appid=${this.apiKey}&units=imperial`
    );
    
    const data = await response.json();
    const forecast = this.parseOpenWeatherResponse(data, date);
    
    // Cache for 1 hour
    this.cache.set(cacheKey, { data: forecast, expiry: Date.now() + 3600000 });
    
    return forecast;
  }
  
  analyzeProductionImpact(forecast: WeatherForecast): ProductionImpact {
    const recommendations: string[] = [];
    let impactLevel: ProductionImpact['impactLevel'] = 'none';
    
    // Hot weather reduces hot food consumption
    if (forecast.high > 90) {
      impactLevel = 'moderate';
      recommendations.push('Consider lighter, cooler menu options');
      recommendations.push('Increase cold beverage production');
      recommendations.push('Reduce hot soup quantities by 20%');
    } else if (forecast.high > 85) {
      impactLevel = 'low';
      recommendations.push('Monitor hot entrÃ©e consumption');
    }
    
    // Cold weather increases comfort food demand
    if (forecast.low < 40) {
      if (impactLevel === 'none') impactLevel = 'low';
      recommendations.push('Increase soup and stew production');
      recommendations.push('Consider adding hot chocolate to beverage station');
    }
    
    // Rain/snow affects cafeteria traffic
    if (forecast.precipitation > 50) {
      impactLevel = impactLevel === 'none' ? 'moderate' : 'high';
      recommendations.push('Expect 15-20% increase in on-site dining');
      recommendations.push('Prepare for delivery delays');
    }
    
    return { impactLevel, recommendations };
  }
}
```

### 6.3 Sysco Integration

```typescript
// backend/src/integrations/sysco.ts

interface SyscoProduct {
  productId: string;
  name: string;
  brand: string;
  packSize: string;
  unitPrice: number;
  casePrice: number;
  unitsPerCase: number;
  category: string;
  nutritionInfo?: {
    servingSize: string;
    calories: number;
    protein: number;
    sodium: number;
  };
  allergens: string[];
  available: boolean;
  leadTimeDays: number;
}

interface SyscoOrder {
  orderId: string;
  status: 'draft' | 'submitted' | 'confirmed' | 'shipped' | 'delivered';
  items: Array<{
    productId: string;
    quantity: number;
    unitPrice: number;
    extendedPrice: number;
  }>;
  subtotal: number;
  deliveryDate: string;
  deliveryWindow: string;
}

export class SyscoService {
  private apiBase: string;
  private credentials: { accountId: string; apiKey: string };
  
  constructor(credentials: { accountId: string; apiKey: string }) {
    this.apiBase = 'https://api.sysco.com/v1';
    this.credentials = credentials;
  }
  
  async searchProducts(query: string, options?: {
    category?: string;
    maxPrice?: number;
    allergenFree?: string[];
  }): Promise<SyscoProduct[]> {
    const params = new URLSearchParams({
      q: query,
      account: this.credentials.accountId,
    });
    
    if (options?.category) params.set('category', options.category);
    if (options?.maxPrice) params.set('maxPrice', options.maxPrice.toString());
    
    const response = await this.apiCall('GET', `/products/search?${params}`);
    
    let products = response.products as SyscoProduct[];
    
    // Filter by allergen-free if requested
    if (options?.allergenFree?.length) {
      products = products.filter(p => 
        !options.allergenFree!.some(a => p.allergens.includes(a))
      );
    }
    
    return products;
  }
  
  async createOrder(items: Array<{ productId: string; quantity: number }>, 
                    deliveryDate: string): Promise<SyscoOrder> {
    const response = await this.apiCall('POST', '/orders', {
      accountId: this.credentials.accountId,
      items,
      requestedDeliveryDate: deliveryDate,
    });
    
    return response.order;
  }
  
  async submitOrder(orderId: string): Promise<SyscoOrder> {
    const response = await this.apiCall('POST', `/orders/${orderId}/submit`);
    return response.order;
  }
  
  async getOrderStatus(orderId: string): Promise<SyscoOrder> {
    const response = await this.apiCall('GET', `/orders/${orderId}`);
    return response.order;
  }
  
  private async apiCall(method: string, path: string, body?: any): Promise<any> {
    const response = await fetch(`${this.apiBase}${path}`, {
      method,
      headers: {
        'Authorization': `Bearer ${this.credentials.apiKey}`,
        'Content-Type': 'application/json',
        'X-Account-Id': this.credentials.accountId,
      },
      body: body ? JSON.stringify(body) : undefined,
    });
    
    if (!response.ok) {
      throw new Error(`Sysco API error: ${response.status}`);
    }
    
    return response.json();
  }
}
```

### 6.4 EHR/EMR Integration (HL7 FHIR)

```typescript
// backend/src/integrations/ehr.ts

interface PatientDietOrder {
  patientId: string;
  patientName: string;
  roomNumber: string;
  dietType: string;
  textureModification?: string;
  liquidConsistency?: string;
  allergies: string[];
  restrictions: string[];
  orderedBy: string;
  orderDate: string;
  effectiveDate: string;
  status: 'active' | 'on-hold' | 'completed';
}

export class EHRService {
  private fhirBase: string;
  private credentials: { clientId: string; clientSecret: string };
  private accessToken?: string;
  
  constructor(fhirBase: string, credentials: { clientId: string; clientSecret: string }) {
    this.fhirBase = fhirBase;
    this.credentials = credentials;
  }
  
  async getDietOrder(patientId: string): Promise<PatientDietOrder | null> {
    await this.ensureAuthenticated();
    
    // Query FHIR NutritionOrder resource
    const response = await fetch(
      `${this.fhirBase}/NutritionOrder?patient=${patientId}&status=active`,
      {
        headers: {
          'Authorization': `Bearer ${this.accessToken}`,
          'Accept': 'application/fhir+json',
        },
      }
    );
    
    if (!response.ok) {
      throw new Error(`EHR API error: ${response.status}`);
    }
    
    const bundle = await response.json();
    
    if (!bundle.entry?.length) {
      return null;
    }
    
    const nutritionOrder = bundle.entry[0].resource;
    return this.mapNutritionOrderToDietOrder(nutritionOrder);
  }
  
  async getAllergies(patientId: string): Promise<string[]> {
    await this.ensureAuthenticated();
    
    const response = await fetch(
      `${this.fhirBase}/AllergyIntolerance?patient=${patientId}&clinical-status=active`,
      {
        headers: {
          'Authorization': `Bearer ${this.accessToken}`,
          'Accept': 'application/fhir+json',
        },
      }
    );
    
    const bundle = await response.json();
    
    return bundle.entry?.map((e: any) => 
      e.resource.code?.coding?.[0]?.display || e.resource.code?.text
    ).filter(Boolean) ?? [];
  }
  
  async subscribeToDietChanges(webhookUrl: string): Promise<void> {
    // Subscribe to FHIR Subscription for NutritionOrder changes
    await this.ensureAuthenticated();
    
    await fetch(`${this.fhirBase}/Subscription`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${this.accessToken}`,
        'Content-Type': 'application/fhir+json',
      },
      body: JSON.stringify({
        resourceType: 'Subscription',
        status: 'requested',
        criteria: 'NutritionOrder?status=active',
        channel: {
          type: 'rest-hook',
          endpoint: webhookUrl,
          payload: 'application/fhir+json',
        },
      }),
    });
  }
  
  private async ensureAuthenticated(): Promise<void> {
    if (this.accessToken) return;
    
    // OAuth2 client credentials flow
    const response = await fetch(`${this.fhirBase}/oauth2/token`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({
        grant_type: 'client_credentials',
        client_id: this.credentials.clientId,
        client_secret: this.credentials.clientSecret,
        scope: 'system/NutritionOrder.read system/AllergyIntolerance.read',
      }),
    });
    
    const data = await response.json();
    this.accessToken = data.access_token;
  }
  
  private mapNutritionOrderToDietOrder(fhirOrder: any): PatientDietOrder {
    return {
      patientId: fhirOrder.patient?.reference?.split('/')[1],
      patientName: fhirOrder.patient?.display,
      roomNumber: fhirOrder.extension?.find(
        (e: any) => e.url.includes('room-number')
      )?.valueString,
      dietType: fhirOrder.oralDiet?.type?.[0]?.coding?.[0]?.display || 'Regular',
      textureModification: fhirOrder.oralDiet?.texture?.[0]?.modifier?.coding?.[0]?.display,
      liquidConsistency: fhirOrder.oralDiet?.fluidConsistencyType?.[0]?.coding?.[0]?.display,
      allergies: [], // Fetched separately
      restrictions: fhirOrder.oralDiet?.nutrient?.map(
        (n: any) => `${n.modifier?.coding?.[0]?.display}: ${n.amount?.value} ${n.amount?.unit}`
      ) || [],
      orderedBy: fhirOrder.orderer?.display,
      orderDate: fhirOrder.dateTime,
      effectiveDate: fhirOrder.dateTime,
      status: fhirOrder.status,
    };
  }
}
```

### 6.5 Browser Automation

```typescript
// backend/src/integrations/browser.ts

import { chromium, Browser, Page } from 'playwright';

interface BrowserResult {
  success: boolean;
  content?: string;
  screenshot?: string;
  error?: string;
}

export class BrowserAutomation {
  private browser?: Browser;
  
  async initialize(): Promise<void> {
    this.browser = await chromium.launch({ headless: true });
  }
  
  async navigate(url: string, options?: {
    selector?: string;
    waitFor?: string;
    action?: 'read' | 'screenshot';
  }): Promise<BrowserResult> {
    if (!this.browser) {
      await this.initialize();
    }
    
    const page = await this.browser!.newPage();
    
    try {
      await page.goto(url, { waitUntil: 'networkidle' });
      
      if (options?.waitFor) {
        await page.waitForSelector(options.waitFor);
      }
      
      if (options?.action === 'screenshot') {
        const screenshot = await page.screenshot({ 
          fullPage: true,
          type: 'png',
        });
        return {
          success: true,
          screenshot: screenshot.toString('base64'),
        };
      }
      
      // Extract content
      let content: string;
      
      if (options?.selector) {
        content = await page.$eval(options.selector, el => el.textContent || '');
      } else {
        // Get main content, excluding navigation, headers, footers
        content = await page.evaluate(() => {
          const main = document.querySelector('main') || 
                       document.querySelector('article') ||
                       document.querySelector('.content') ||
                       document.body;
          return main.innerText;
        });
      }
      
      return { success: true, content };
      
    } catch (error) {
      return { 
        success: false, 
        error: error instanceof Error ? error.message : 'Navigation failed' 
      };
    } finally {
      await page.close();
    }
  }
  
  async fillAndSubmitForm(url: string, formData: Record<string, string>, 
                          submitSelector: string): Promise<BrowserResult> {
    if (!this.browser) {
      await this.initialize();
    }
    
    const page = await this.browser!.newPage();
    
    try {
      await page.goto(url, { waitUntil: 'networkidle' });
      
      // Fill form fields
      for (const [selector, value] of Object.entries(formData)) {
        await page.fill(selector, value);
      }
      
      // Submit and wait for navigation
      await Promise.all([
        page.waitForNavigation(),
        page.click(submitSelector),
      ]);
      
      const content = await page.evaluate(() => document.body.innerText);
      
      return { success: true, content };
      
    } catch (error) {
      return { 
        success: false, 
        error: error instanceof Error ? error.message : 'Form submission failed' 
      };
    } finally {
      await page.close();
    }
  }
  
  async close(): Promise<void> {
    await this.browser?.close();
  }
}
```

---

## Part 7: Implementation Roadmap

### 7.1 Phase Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           IMPLEMENTATION ROADMAP                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  PHASE 1: FOUNDATION (Weeks 1-4)                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Entity Tree     â”‚ â”‚ Center Canvas   â”‚ â”‚ Schema Updates  â”‚                   â”‚
â”‚  â”‚ Navigation      â”‚ â”‚ Basic Views     â”‚ â”‚ (llm_notes)     â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                                 â”‚
â”‚  PHASE 2: AGENT CORE (Weeks 5-8)                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Agent Panel     â”‚ â”‚ Context         â”‚ â”‚ Core Data       â”‚                   â”‚
â”‚  â”‚ UI              â”‚ â”‚ Aggregation     â”‚ â”‚ Tools           â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                                 â”‚
â”‚  PHASE 3: ALGORITHMS (Weeks 9-12)                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Recipe Tools    â”‚ â”‚ Menu Planning   â”‚ â”‚ Forecasting     â”‚                   â”‚
â”‚  â”‚ (scale, cost)   â”‚ â”‚ Tools           â”‚ â”‚ Tools           â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                                 â”‚
â”‚  PHASE 4: INTEGRATIONS (Weeks 13-16)                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Weather &       â”‚ â”‚ Sysco           â”‚ â”‚ EHR             â”‚                   â”‚
â”‚  â”‚ Seasonal        â”‚ â”‚ Integration     â”‚ â”‚ Integration     â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                                 â”‚
â”‚  PHASE 5: POLISH (Weeks 17-20)                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Omni-Search     â”‚ â”‚ Voice Input     â”‚ â”‚ Advanced Views  â”‚                   â”‚
â”‚  â”‚ Enhancement     â”‚ â”‚                 â”‚ â”‚ & Dashboards    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Detailed Phase Breakdown

#### Phase 1: Foundation (Weeks 1-4)

| Week | Deliverables | Key Tasks |
|------|--------------|-----------|
| 1 | Schema Updates | Add `llm_notes` to all relevant tables, create migration |
| 1 | Entity Tree Component | Build tree UI with expand/collapse, badges |
| 2 | Entity Tree Data | Connect tree to API, implement lazy loading |
| 2 | Basic Center Canvas | Tab container, entity view router |
| 3 | Recipe View | Full recipe detail view with ingredients table |
| 3 | Diner View | Diner profile with diet info and meal history |
| 4 | Menu Calendar View | Basic week grid, menu item display |
| 4 | Layout Integration | Three-panel layout with resizing |

**Milestone**: Users can navigate entity tree and view details in center canvas.

#### Phase 2: Agent Core (Weeks 5-8)

| Week | Deliverables | Key Tasks |
|------|--------------|-----------|
| 5 | Agent Panel UI | Chat interface, message display, input |
| 5 | LLM Integration | Connect to Claude API, basic completion |
| 6 | Context Aggregation | Build hierarchy walker, format for prompt |
| 6 | Context Display | Show active llm_notes in agent panel |
| 7 | Tool Framework | Tool registry, execution, result handling |
| 7 | Core Data Tools | `db_query`, `db_get`, `db_create`, `db_update` |
| 8 | Agent Orchestration | Multi-turn conversation, tool chaining |
| 8 | Action Buttons | Embedded actions in agent responses |

**Milestone**: Users can chat with agent, agent can query/modify data.

#### Phase 3: Algorithms (Weeks 9-12)

| Week | Deliverables | Key Tasks |
|------|--------------|-----------|
| 9 | Recipe Tools | `recipe_scale`, `recipe_cost` |
| 9 | Unit Conversion | Robust unit conversion system |
| 10 | Diet Validation | `validate_diet`, `check_allergens` |
| 10 | Nutrient Checking | `check_nutrients` for therapeutic diets |
| 11 | Menu Planning | `protein_spread`, `analyze_menu`, `suggest_menu_items` |
| 11 | Cost Optimization | `cost_optimize` for recipes and menus |
| 12 | Forecasting | `forecast_demand`, census and item-level |
| 12 | Production | `generate_production_schedule` |

**Milestone**: Agent can perform complex menu planning and production scheduling.

#### Phase 4: Integrations (Weeks 13-16)

| Week | Deliverables | Key Tasks |
|------|--------------|-----------|
| 13 | Weather Service | OpenWeather integration, production impact |
| 13 | Seasonal Produce | Seasonal data service, regional support |
| 14 | Sysco Search | Product search, price retrieval |
| 14 | Sysco Orders | Order creation, submission, tracking |
| 15 | EHR Integration | FHIR client, diet order sync |
| 15 | Webhook Handlers | Real-time diet change notifications |
| 16 | Browser Automation | Playwright integration for web tasks |
| 16 | Integration Testing | End-to-end integration test suite |

**Milestone**: Agent can access external data and place vendor orders.

#### Phase 5: Polish (Weeks 17-20)

| Week | Deliverables | Key Tasks |
|------|--------------|-----------|
| 17 | Omni-Search | Full âŒ˜K implementation with NL search |
| 17 | Search Indexing | Real-time index updates, fuzzy matching |
| 18 | Voice Input | Speech-to-text integration |
| 18 | Agent Personalities | Chef, Dietitian, Manager modes |
| 19 | Production Dashboard | Full production hub view |
| 19 | Inventory Dashboard | Inventory intelligence view |
| 20 | Analytics Dashboard | Cost tracking, waste analysis |
| 20 | Documentation | User guide, admin guide, API docs |

**Milestone**: Complete "Cursor for Food" experience ready for production.

### 7.3 Success Criteria

| Metric | Target | Measurement |
|--------|--------|-------------|
| Agent Response Time | < 3 seconds | 95th percentile latency |
| Tool Execution Success | > 95% | Error rate monitoring |
| User Task Completion | > 80% | Task success rate in testing |
| Search Relevance | > 90% | User satisfaction surveys |
| Context Accuracy | 100% | llm_notes correctly aggregated |
| Integration Uptime | > 99% | External service availability |

---

## Appendices

### Appendix A: Cursor Rules Template

This document enables generation of `.cursorrules` files for development:

```markdown
# Cursor for Food Development Rules

## Project Context
You are developing "Cursor for Food", an AI-native commercial kitchen management platform.
The system mirrors Cursor IDE's architecture but for food service operations.

## Technology Stack
- Frontend: React 18, TypeScript, TailwindCSS, TanStack Query, TanStack Table
- Backend: Node.js, tRPC, Drizzle ORM, SQLite
- AI: Claude API (Anthropic), Tool/Function calling
- Testing: Vitest, Playwright

## Domain Knowledge
Reference: docs/FoodServiceManagement.md (Payne-Palacio & Theis, 13th Ed.)

Key concepts:
- Standardized recipes with AP/EP measurements
- Cycle menus (typically 3-4 weeks)
- Therapeutic diets (regular, diabetic, renal, low-sodium, etc.)
- HACCP food safety (critical control points, temp logging)
- Par levels and reorder points for inventory
- Production forecasting using historical data

## Code Conventions
- Use TypeScript strict mode
- Prefer functional components with hooks
- Use Zod for runtime validation
- Follow existing patterns in codebase
- Add JSDoc comments for public APIs

## Data Model
See: backend/src/db/schema/*.ts
- Multi-tenant architecture (tenant_id on operational tables)
- llm_notes field for hierarchical context
- Drizzle ORM with SQLite

## Testing
- Unit tests for algorithms
- Integration tests for services
- E2E tests for critical user flows
```

### Appendix B: Glossary

| Term | Definition |
|------|------------|
| AP (As Purchased) | Weight/quantity as received from vendor before trimming |
| EP (Edible Portion) | Usable portion after trimming, peeling, cooking loss |
| Cycle Menu | Planned set of menus that rotate at regular intervals |
| HACCP | Hazard Analysis Critical Control Point - food safety system |
| llm_notes | Hierarchical context field for LLM prompts |
| Menu Pattern | Structure defining choices per category per meal |
| Par Level | Target inventory level to maintain |
| Reorder Point | Inventory level that triggers reordering |
| Standardized Recipe | Tested recipe adapted to facility's requirements |
| Therapeutic Diet | Medically prescribed diet modification |
| Trayline | Assembly line for plating patient meal trays |

### Appendix C: Database Schema Summary

See full schemas in: `backend/src/db/schema/`

| Schema File | Tables | Purpose |
|-------------|--------|---------|
| reference.ts | units_of_measure, food_categories, allergens, food_composition_sources | Shared lookup data |
| tenants.ts | tenants, sites, stations, employees | Organization structure |
| menu.ts | meal_periods, diet_types, cycle_menus, menu_items, menu_patterns | Menu planning |
| recipes.ts | ingredients, recipes, recipe_ingredients | Recipe management |
| diners.ts | diners, diet_assignments, meal_orders | Customer/patient management |
| inventory.ts | receiving, inventory, storeroom_issues | Inventory control |
| production.ts | production_schedules, forecasts, leftover_reports | Production operations |
| procurement.ts | vendors, purchase_orders, po_line_items | Purchasing |

---

*Document Version: 1.0*
*Last Updated: February 2026*
*Reference: Foodservice Management: Principles and Practices, 13th Edition (Payne-Palacio & Theis)*

